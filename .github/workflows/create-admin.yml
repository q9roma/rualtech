name: Create Admin User

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'Admin name'
        required: true
        default: 'alexsoroka'
      email:
        description: 'Admin email'
        required: true
        default: 'corp-altekh07938@yandex.ru'
      password:
        description: 'Admin password'
        required: true
        default: 'admin123!'

jobs:
  create-admin:
    runs-on: ubuntu-latest
    
    steps:
    - name: Create Admin User on Production
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: rualtech.ru
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          echo "ğŸ” Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ..."
          cd /var/www/www-root/data/www/rualtech.ru
          
          # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
          php artisan admin:create "${{ github.event.inputs.name }}" "${{ github.event.inputs.email }}" "${{ github.event.inputs.password }}" || echo "User may already exist"
          
          # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½
          php artisan tinker --execute="echo App\\Models\\User::where('email', '${{ github.event.inputs.email }}')->first() ? 'User exists: ${{ github.event.inputs.email }}' : 'User not found'"
          
          echo "âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾! ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºÑƒ:"
          echo "ğŸ“ URL: https://rualtech.ru/admin/login"
          echo "ğŸ“§ Email: ${{ github.event.inputs.email }}"
          echo "ğŸ”‘ Password: [hidden]"
