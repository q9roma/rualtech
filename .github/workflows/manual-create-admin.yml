name: Manual Create Admin

on:
  workflow_dispatch:

jobs:
  create-admin:
    runs-on: ubuntu-latest
    
    steps:
    - name: Create Admin User on Production
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: rualtech.ru
        username: u2465636
        key: ${{ secrets.SSH_KEY }}
        script: |
          echo "ğŸ” Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğ° production..."
          cd /var/www/www-root/data/www/rualtech.ru
          
          echo "ğŸ“ Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ:"
          pwd
          
          echo "ğŸ“‚ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸:"
          ls -la
          
          echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ artisan:"
          ls -la artisan
          
          echo "ğŸ‘¤ Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ..."
          php artisan admin:create "alexsoroka" "corp-altekh07938@yandex.ru" "admin123!" 2>&1 || echo "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ°, Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ±..."
          
          echo "ğŸ”§ ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ñ‡ĞµÑ€ĞµĞ· tinker..."
          php artisan tinker --execute="
          try {
            \$user = App\\Models\\User::where('email', 'corp-altekh07938@yandex.ru')->first();
            if (!\$user) {
              \$user = App\\Models\\User::create([
                'name' => 'alexsoroka',
                'email' => 'corp-altekh07938@yandex.ru',
                'password' => Hash::make('admin123!')
              ]);
              echo 'User created successfully';
            } else {
              \$user->password = Hash::make('admin123!');
              \$user->save();
              echo 'User password updated';
            }
          } catch (Exception \$e) {
            echo 'Error: ' . \$e->getMessage();
          }
          " 2>&1 || echo "Tinker failed"
          
          echo "âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:"
          php artisan tinker --execute="echo App\\Models\\User::where('email', 'corp-altekh07938@yandex.ru')->first() ? 'User exists' : 'User not found'" 2>&1
          
          echo "ğŸ¯ Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾! Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°:"
          echo "ğŸ“ URL: https://rualtech.ru/admin/login"
          echo "ğŸ“§ Email: corp-altekh07938@yandex.ru"
          echo "ğŸ”‘ Password: admin123!"
