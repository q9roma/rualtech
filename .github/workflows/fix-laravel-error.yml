name: Fix Laravel Error

on:
  workflow_dispatch:

jobs:
  fix-error:
    runs-on: ubuntu-latest
    
    steps:
    - name: Fix Laravel Error
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          echo "ğŸ”§ Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Laravel..."
          cd /var/www/www-root/data/www/rualtech.ru
          
          # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ helper Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
          echo "ğŸš« Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ½Ñ‹Ğ¹ helper..."
          sed -i 's/require_once app_path.*RussianPluralHelper.php.*;//g' app/Providers/AppServiceProvider.php
          
          # ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ğ²ÑĞµ ĞºĞµÑˆĞ¸
          echo "ğŸ§¹ ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ ĞºĞµÑˆĞ¸..."
          php artisan config:clear
          php artisan cache:clear
          php artisan view:clear
          php artisan route:clear
          
          # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°ÑÑŒ Ğ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
          echo "ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ..."
          curl -I https://rualtech.ru/ 2>/dev/null | head -1
          
          echo "ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºÑƒ..."
          curl -I https://rualtech.ru/admin/login 2>/dev/null | head -1
          
          echo ""
          echo "âœ… ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ·Ğ°Ğ¹Ñ‚Ğ¸ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºÑƒ ÑĞµĞ¹Ñ‡Ğ°Ñ:"
          echo "ğŸ”— https://rualtech.ru/admin/login"
          echo "ğŸ“§ corp-altekh07938@yandex.ru"
          echo "ğŸ”‘ admin123!"
