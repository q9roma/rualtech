name: Fix Admin User

on:
  workflow_dispatch:

jobs:
  fix-admin:
    runs-on: ubuntu-latest
    
    steps:
    - name: Fix Admin User via Tinker
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          echo "ğŸ”§ Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°..."
          cd /var/www/www-root/data/www/rualtech.ru
          
          echo "ğŸ“ Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ°: $(pwd)"
          
          # ĞŸÑ€ÑĞ¼Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ñ‡ĞµÑ€ĞµĞ· tinker
          php artisan tinker --execute="
          use App\\Models\\User;
          use Illuminate\\Support\\Facades\\Hash;
          
          \\$email = 'corp-altekh07938@yandex.ru';
          \\$user = User::where('email', \\$email)->first();
          
          if (!\\$user) {
            \\$user = User::create([
              'name' => 'alexsoroka',
              'email' => \\$email,
              'password' => Hash::make('admin123!')
            ]);
            echo 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: ' . \\$user->email;
          } else {
            \\$user->password = Hash::make('admin123!');
            \\$user->save();
            echo 'ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ´Ğ»Ñ: ' . \\$user->email;
          }
          "
          
          echo ""
          echo "âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾! ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°:"
          echo "ğŸŒ https://rualtech.ru/admin/login"
          echo "ğŸ“§ corp-altekh07938@yandex.ru"
          echo "ğŸ” admin123!"
