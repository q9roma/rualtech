name: Check MySQL Users

on:
  workflow_dispatch:

jobs:
  check-mysql:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check MySQL configuration
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /var/www/www-root/data/www/rualtech.ru/
          
          echo "üîç === –ü–†–û–í–ï–†–ö–ê MYSQL ==="
          
          echo "üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:"
          mysql -e "SHOW DATABASES;" 2>/dev/null || echo "‚ùå MySQL –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          
          echo "üîë –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"
          echo "1. –ü—Ä–æ–±—É–µ–º mysql –±–µ–∑ –ø–∞—Ä–æ–ª—è:"
          mysql -u root -e "SELECT USER();" 2>/dev/null || echo "‚ùå root –±–µ–∑ –ø–∞—Ä–æ–ª—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          
          echo "2. –ü—Ä–æ–±—É–µ–º mysql —Å –ø—É—Å—Ç—ã–º –ø–∞—Ä–æ–ª–µ–º:"
          mysql -u root -p'' -e "SELECT USER();" 2>/dev/null || echo "‚ùå root —Å –ø—É—Å—Ç—ã–º –ø–∞—Ä–æ–ª–µ–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          
          echo "3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å rualtech:"
          mysql -u rualtech -e "SELECT USER();" 2>/dev/null || echo "‚ùå –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å rualtech –±–µ–∑ –ø–∞—Ä–æ–ª—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
          
          echo "üîç –ò—â–µ–º —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ MySQL:"
          find /etc -name "*.cnf" 2>/dev/null | head -5 || echo "–ö–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          
          echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ë–î:"
          env | grep -i mysql || echo "MySQL –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
          env | grep -i db || echo "DB –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
          
          echo "üîß –ü–æ–ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤:"
          if [ -f ".env.example" ]; then
            echo "--- .env.example ---"
            grep "DB_" .env.example || echo "–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ë–î –≤ .env.example"
          fi
          
          if [ -f ".env.backup" ]; then
            echo "--- .env.backup ---"
            grep "DB_" .env.backup || echo "–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ë–î –≤ .env.backup"
          fi
